function initMap(){"use strict";map=new google.maps.Map(document.getElementById("map-canvas"),{center:{lat:33.9531,lng:-83.9925},zoom:14}),ko.applyBindings(new ViewModel)}var CLIENT_ID="5B0HOZHGVVSMFTIXXGMRMZRAZ3NV20H2LJJ1E35IEOJMUTN0",CLIENT_SECRET="O4F5DYQQ21YC40UEAJFKBOLAL2AHJU5CQC2RP00MWNV3OIPN",GOOGLE_KEY="AIzaSyDTYSjuoZcmdc_12MTieNOK2gmHsdb3PBo",fsCategories=[{name:"Hotel",id:"4bf58dd8d48988d1fa931735"},{name:"Restaurants",id:"4d4b7105d754a06374d81259"},{name:"Airport",id:"4bf58dd8d48988d1ed931735"},{name:"Gas Stations",id:"4bf58dd8d48988d113951735"},{name:"Shopping",id:"4d4b7105d754a06378d81259"},{name:"Movie Theatre",id:"4bf58dd8d48988d17f941735"},{name:"Colleges & Universities",id:"4d4b7105d754a06372d81259"},{name:"Arts & Entertainment",id:"4d4b7104d754a06370d81259"},{name:"Gym & Fitness",id:"4bf58dd8d48988d175941735"},{name:"Medical Centers",id:"4bf58dd8d48988d104941735"}],map,ViewModel=function(){var e=this;e.map=null,e.fsVenues=ko.observableArray([]),e.lat=ko.observable(33.9531),e.lng=ko.observable(-83.9925),e.search=function(){"use strict";var o=$("#searchTerm").val();o=o.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()}),$(".markerList > li").each(function(){$(this).text().search(o)>-1?$(this).show():$(this).hide()});for(var a=0;a<e.fsVenues().length;a++)e.fsVenues()[a].marker.title.search(o)>-1?e.fsVenues()[a].marker.setMap(e.map):e.fsVenues()[a].marker.setMap(null)},e.selectVenue=function(o){e.clearInfoWindows(),e.clearMarkerAnimation(),o.marker.setAnimation(google.maps.Animation.BOUNCE),o.infowindow.open(e.map,o.marker),e.map.setCenter(new google.maps.LatLng(o.location.lat,o.location.lng))},e.mapType=ko.observable(),e.settings=function(o){"Hybrid"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.HYBRID),"Road"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.ROADMAP),"Satellite"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.SATELLITE),"Terrain"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.TERRAIN)},e.clearMarkerAnimation=function(){for(var o=0;o<e.fsVenues().length;o++)e.fsVenues()[o].marker.setAnimation(null)},e.clearInfoWindows=function(){for(var o=0;o<e.fsVenues().length;o++)e.fsVenues()[o].infowindow.close()};var o=document.getElementById("optionsTransform"),a=document.getElementById("down");a.style.transform="rotate(180deg)",$("#venues").addClass("venues-toggle"),o.addEventListener("click",function(){$("#venues").toggleClass("venues-toggle"),a.style.transform+="rotate(180deg)"});for(var n=[],t=0;t<fsCategories.length;t++)n.push(fsCategories[t].id);var s=n.join(",");if(e.chosenCategoryID=ko.observable(s),e.catChoice=ko.observable(),e.setCategory=function(){for(var o=0;o<fsCategories.length;o++)e.catChoice()[0]===fsCategories[o].name&&e.chosenCategoryID(fsCategories[o].id);e.initializeMap()},e.city=ko.observable($("#city").val()),e.setCity=function(){var o=$("#city").val();e.city(o),$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address="+e.city()+"&key="+GOOGLE_KEY,function(o){e.lat(o.results[0].geometry.location.lat),e.lng(o.results[0].geometry.location.lng),e.map.setCenter({lat:e.lat(),lng:e.lng()})}).error(function(){$("#error").text("Google Geocode is not responding. Please try again later.").show(),console.log("Google Geocode API error")}),e.initializeMap(),$("#city").val("")},e.initializeMap=function(){$.getJSON("https://api.foursquare.com/v2/venues/search?client_id="+CLIENT_ID+"&client_secret="+CLIENT_SECRET+"&v=20130815&limit=50&categoryId="+e.chosenCategoryID()+"&radius=6000&near="+e.city(),function(o){venuesModel=o.response.venues,e.fsVenues(venuesModel),console.log("Foursquare venues load Successful"),setMarkers(),$("#error").hide()}).error(function(){$("#error").text("Foursquare failed to retrieve venues based on current search please refine and retry").show(),console.log("Foursquare API failure to load")}),this.setMarkers=function(){for(var o=0;o<e.fsVenues().length;o++){var a=e.fsVenues()[o],n=a.location.address,t=a.location.city,s=a.location.state,r=a.location.postalCode,i=a.contact.formattedPhone,l=a.url;void 0===n&&(n=""),void 0===t&&(t=""),void 0===s&&(s=""),void 0===r&&(r=""),void 0===i&&(i="N/A"),void 0===l&&(l="No Website");var d=a.categories[0].icon.prefix+"bg_32"+a.categories[0].icon.suffix,c=d.replace("https://ss3.4sqi.net","https://foursquare.com");a.marker=new google.maps.Marker({position:new google.maps.LatLng(a.location.lat,a.location.lng),title:a.name,map:e.map,animation:google.maps.Animation.DROP,icon:c,html:'<div><h2 class="infoTitle">'+a.name+'</h2><h4 class="infoCategory">'+a.categories[0].name+'</h4><p class="infoPhone">Phone: '+i+'<p class="infoAddress">Address: '+n+" "+t+", "+s+" "+r+'</p><p class="infoWeb"><a href="'+l+'">'+l+"</a> </p></div>"}),a.infowindow=new google.maps.InfoWindow,a.infowindow.setContent(a.marker.html),google.maps.event.addListener(a.marker,"click",function(o){return function(){e.clearInfoWindows(),e.clearMarkerAnimation(),e.map.setCenter(new google.maps.LatLng(e.fsVenues()[o].location.lat,e.fsVenues()[o].location.lng)),e.fsVenues()[o].infowindow.open(e.map,e.fsVenues()[o].marker),e.fsVenues()[o].marker.setAnimation(google.maps.Animation.BOUNCE)}}(o))}};var o=[{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#9b7db1"}]},{featureType:"road.highway.controlled_access",stylers:[{hue:"#ff0000"}]},{featureType:"road.highway",stylers:[{hue:"#5eff00"}]},{featureType:"transit.line",stylers:[{color:"#bb5580"}]},{featureType:"landscape.natural",stylers:[{hue:"#00ffee"},{color:"#C28585"}]},{featureType:"landscape.man_made",stylers:[{hue:"#f6ff00"},{color:"##FFC39C"}]}],a={center:{lat:e.lat(),lng:e.lng()},zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!0,zoomControl:!0,panControl:!0,mapTypeControl:!0};e.map=new google.maps.Map(document.getElementById("map-canvas"),a),e.map.setOptions({styles:o})},"undefined"==typeof google){var r="Google Maps could did not load correctly, check your network and try again later";$("#error").text(r).show(),console.log("Google Maps API failed")}else $("#error").hide(),google.maps.event.addDomListener(window,"load",this.initializeMap),console.log("Google Maps Successfully loaded")};